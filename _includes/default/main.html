{% include setup.html %}
<div class="main-container">
    <!-- <div class="panel horizontal border-bottom-fine-dotted-line">
        è¿™é‡Œæ˜¯ä¸€ä¸ªä¸ªäººä¹¦æ¶ï¼Œå­˜å‚¨ç€ä¸ªäººæ”¶è—çš„ä¹¦ç±ã€‚
    </div> -->

    <div class="panel vertical search">
        <div class="panel horizontal">
        <input type="text" id="search_input" /> <button class="button" onclick="search_books()">æœç´¢</button>
        </div>
        
        <div class="panel horizontal">
            ğŸ’¡ è¿™é‡Œæ˜¯ä¸€ä¸ªä¸ªäººä¹¦æ¶ï¼Œå­˜å‚¨ç€ä¸ªäººæ”¶è—çš„ä¹¦ç±ã€‚
        </div>
        <input type="text" style="display:none;" id="search_data_url" value="{{namespace}}/data/books.json?v={{site.github.build_revision}}"/>

        <script>
            window.onload = function() {
                axios.get(document.getElementById("search_data_url").value)
                .then( function(response){
                    var options = {
                        shouldSort: true,
                        threshold: 0.6,
                        location: 0,
                        distance: 100,
                        maxPatternLength: 32,
                        minMatchCharLength: 1,
                        keys: [
                            "name","author"
                        ]
                    };

                    var data =response.data

                    if(data.length >0){
                        document.getElementById("show_newbook").innerHTML = "";
                        for (let index = 0; index < 5; index++) {
                            const element = data[index];
                            if (element){
                                add_bookitem(element,"show_newbook");
                            }else {
                                break;
                            }
                        }
                    }
                    window.fuse = new Fuse(data, options);
                })
            }
            var notfound = function(){
                var obj = document.getElementById("search_book_panel");
                obj.setAttribute("style","display:block;")
                var obj = document.getElementById("search_book");
                obj.innerHTML = "æ²¡æœ‰æœç´¢åˆ°ç›¸åº”ä¹¦ç±"
            }
            var add_bookitem = function(data,pid){
                var panel = document.getElementById(pid);
                var html = "";
                html = html + "<span>ä¹¦åï¼š<a>"+data.name+"</a></span>&nbsp;&nbsp;|&nbsp;&nbsp;";
                html = html + "<span id='"+data.author+"'>ä½œè€…ï¼š<a>"+data.author+"</a></span>&nbsp;&nbsp;|&nbsp;&nbsp;";
                //
                create_tip_tag(data.author)
                html = html + "<span>æ ¼å¼ï¼š";
                    
                    for (let index = 0; index < data.expand.length; index++) {
                        const element = data.expand[index];
                        html = html + '<a title="ä¸‹è½½" href="'+element.url+'">'+element.name+'</a>';
                        if (index < data.expand.length-1){html = html + "ã€";}
                    }
                html = html + "</span>"
                html = html + "<span style='right: 0;position: absolute;'>ä¸Šä¼ æ—¶é—´ï¼š"+get_date(data.update)+"</span>";

                panel.innerHTML = panel.innerHTML + '<div class="panel horizontal border-bottom-fine-dotted-line">'+html+'</div>'
            }

            var create_tip_tag = function addScript( id ) {
                var script = document.createElement("script");
                script.type = "text/javascript";
                script.appendChild(document.createTextNode('tippy("#'+id+'", {content: "'+id+'"});'));
                document.body.appendChild(script);
            }

            var search_books = function() {
                var text = document.getElementById("search_input").value;
                if(window.fuse){
                    var result = window.fuse.search(text);
                            
                    if(result && result.length >0){
                        var obj = document.getElementById("search_book_panel");
                        obj.setAttribute("style","display:block;")
                        document.getElementById("search_book").innerHTML = "";
                        for (let index = 0; index < result.length; index++) {
                            const element = result[index];
                            if (element){
                                add_bookitem(element,"search_book");
                            }else {
                                break;
                            }
                            
                        }
                    }else{
                        notfound();
                    }
                }
            }

            var get_date = function(str){
                var date= new Date(str);
                var year = date.getFullYear();//å¹´
            ã€€ã€€var month = date.getMonth();//æœˆ
            ã€€ã€€var day = date.getDate();//æ—¥
            ã€€ã€€var hours = date.getHours();//æ—¶
            ã€€ã€€var min = date.getMinutes();//åˆ†
            ã€€ã€€var second = date.getSeconds();//ç§’

                return year+'å¹´'+month+'æœˆ'+day+'æ—¥ '//+hours+'æ—¶'+min+'åˆ†'+second+'ç§’'
            }

            
        </script>
    </div>

    <div style="display: none;" id="search_book_panel" class="panel vertical border-bottom-coarse-solid-line border-wide-v-3
    border-right-coarse-solid-line border-left-coarse-solid-line shadow">
        <div class="title">æœç´¢ä¹¦ç±</div>
        <div id="search_book"></div>
    </div>

    <div class="panel vertical border-bottom-coarse-solid-line border-wide-v-3
    border-right-coarse-solid-line border-left-coarse-solid-line shadow">
        <div class="title">æœ€æ–°æ·»åŠ ä¹¦ç±</div>
        <div id="show_newbook">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•ä¹¦ç±ï¼ğŸ˜Š</div>
    </div>
</div>